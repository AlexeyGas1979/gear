title: create_program sys-call test

programs:
  - id: 1
    path: examples/create-program/child_contract.wasm
  - id: 2
    path: target/wasm32-unknown-unknown/release/demo_create_program.wasm

fixtures:
  - title: create_program test with intermediate check
    messages:
      - destination: 2
    expected:
      - step: 1
        messages:
          # new program creation message
          - destination:
              kind: ss58
              # computed manually new program address
              value: 5Fypuf8SCGzqtJy91VJqb17WgUbgVTC6k3Vb4yfj3VBj2at1
            gas_limit: 10000
          - destination:
              kind: ss58
              value: 5Fypuf8SCGzqtJy91VJqb17WgUbgVTC6k3Vb4yfj3VBj2at1
            gas_limit: 10001
      - step: 3
        allocations:
          # we check program existence by checking allocations on program
          - program_id:
              kind: ss58
              value: 5Fypuf8SCGzqtJy91VJqb17WgUbgVTC6k3Vb4yfj3VBj2at1
            page_count: 1
  - title: create_program test only final state
    messages:
      - destination: 2
    expected:
      - allocations:
        # we check program existence by checking allocations on program
        - program_id:
            kind: ss58
            value: 5Fypuf8SCGzqtJy91VJqb17WgUbgVTC6k3Vb4yfj3VBj2at1
          page_count: 1